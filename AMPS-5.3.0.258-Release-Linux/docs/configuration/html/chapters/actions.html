<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>14. Actions &#8212; Advanced Message Processing System (AMPS) Configuration Guide 5.3.0.255
 documentation</title>
    
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.3.0.255',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="15. Protocols" href="protocols.html" />
    <link rel="prev" title="13. Entitlement" href="entitlement.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body role="document">
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/flag_logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">14. Actions</a><ul>
<li><a class="reference internal" href="#configuration-for-actions">Configuration for Actions</a><ul>
<li><a class="reference internal" href="#on-element-when-an-action-runs">On Element: When an Action Runs</a><ul>
<li><a class="reference internal" href="#running-an-action-on-a-schedule">Running an Action on a Schedule</a></li>
<li><a class="reference internal" href="#running-an-action-in-response-to-a-signal">Running an Action in Response to a Signal</a></li>
<li><a class="reference internal" href="#default-signal-actions">Default Signal Actions</a></li>
<li><a class="reference internal" href="#running-an-action-on-startup-or-shutdown">Running an Action on Startup or Shutdown</a></li>
<li><a class="reference internal" href="#running-an-action-on-client-logon">Running an Action on Client Logon</a></li>
<li><a class="reference internal" href="#running-an-action-on-client-connection">Running an Action on Client Connection</a></li>
<li><a class="reference internal" href="#running-an-action-on-message-delivery">Running an Action on Message Delivery</a></li>
<li><a class="reference internal" href="#running-an-action-on-message-publish">Running an Action on Message Publish</a></li>
<li><a class="reference internal" href="#running-an-action-on-oof-message">Running an Action on OOF Message</a></li>
<li><a class="reference internal" href="#running-an-action-on-minidump">Running an Action on Minidump</a></li>
<li><a class="reference internal" href="#running-an-action-on-offline-start-or-stop">Running an Action on Offline Start or Stop</a></li>
<li><a class="reference internal" href="#running-an-action-on-sow-message-deletion">Running an Action on SOW Message Deletion</a></li>
<li><a class="reference internal" href="#running-an-action-on-sow-message-expiration">Running an Action on SOW Message Expiration</a></li>
<li><a class="reference internal" href="#running-an-action-on-message-state-change">Running an Action on Message State Change</a></li>
<li><a class="reference internal" href="#running-an-action-on-message-condition-timeout">Running an Action on Message Condition Timeout</a></li>
<li><a class="reference internal" href="#running-an-action-on-a-custom-event">Running an Action on a Custom Event</a></li>
</ul>
</li>
<li><a class="reference internal" href="#do-element-defining-the-action-to-take">Do Element: Defining the Action to Take</a><ul>
<li><a class="reference internal" href="#rotate-log-files">Rotate Log Files</a></li>
<li><a class="reference internal" href="#manage-the-statistics-database">Manage the Statistics Database</a></li>
<li><a class="reference internal" href="#manage-journal-files">Manage Journal Files</a></li>
<li><a class="reference internal" href="#compressing-files">Compressing Files</a></li>
<li><a class="reference internal" href="#removing-files">Removing Files</a></li>
<li><a class="reference internal" href="#deleting-messages-from-sow">Deleting Messages from SOW</a></li>
<li><a class="reference internal" href="#compacting-a-sow-file">Compacting a SOW File</a></li>
<li><a class="reference internal" href="#querying-a-sow-topic">Querying a SOW Topic</a></li>
<li><a class="reference internal" href="#manage-security">Manage Security</a></li>
<li><a class="reference internal" href="#enable-and-disable-a-transport">Enable and Disable a Transport</a></li>
<li><a class="reference internal" href="#publishing-messages">Publishing Messages</a></li>
<li><a class="reference internal" href="#manage-replication">Manage Replication</a></li>
<li><a class="reference internal" href="#extract-values">Extract Values</a></li>
<li><a class="reference internal" href="#translate-data">Translate Data</a></li>
<li><a class="reference internal" href="#increment-counter">Increment Counter</a></li>
<li><a class="reference internal" href="#raising-a-custom-event">Raising a Custom Event</a></li>
<li><a class="reference internal" href="#executing-system-commands">Executing System Commands</a></li>
<li><a class="reference internal" href="#debugging-actions">Debugging Actions</a></li>
<li><a class="reference internal" href="#creating-a-minidump">Creating a Minidump</a></li>
<li><a class="reference internal" href="#shut-down-amps">Shut Down AMPS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#if-element-conditionally-stop-action-sequence">If Element: Conditionally Stop Action Sequence</a><ul>
<li><a class="reference internal" href="#file-system-usage">File System Usage</a></li>
</ul>
</li>
<li><a class="reference internal" href="#action-configuration-examples">Action Configuration Examples</a><ul>
<li><a class="reference internal" href="#archive-transaction-log-journal-files-older-than-one-week-every-saturday">Archive Transaction Log Journal Files Older Than One Week, Every Saturday</a></li>
<li><a class="reference internal" href="#disable-and-re-enable-security-on-signal">Disable and Re-enable Security on Signal</a></li>
<li><a class="reference internal" href="#reset-entitlements-for-a-disconnected-client">Reset entitlements for a disconnected client</a></li>
<li><a class="reference internal" href="#extract-values-on-publish-of-a-message">Extract Values on Publish of a Message</a></li>
<li><a class="reference internal" href="#increment-a-counter-and-echo-a-message-on-signal">Increment a Counter and Echo a Message on Signal</a></li>
<li><a class="reference internal" href="#recording-expired-queue-messages-in-a-dead-letter-topic">Recording Expired Queue Messages in a Dead Letter Topic</a></li>
<li><a class="reference internal" href="#copy-a-message-to-a-different-topic-when-a-timeout-is-exceeded">Copy a Message to a Different Topic When a Timeout is Exceeded</a></li>
<li><a class="reference internal" href="#shutting-down-amps-when-filesystem-fills">Shutting Down AMPS When Filesystem Fills</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="entitlement.html" title="previous chapter">13. Entitlement</a></li>
      <li>Next: <a href="protocols.html" title="next chapter">15. Protocols</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="actions">
<h1>14. Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h1>
<p>AMPS includes the ability to perform administrative tasks in response to
Linux signals or on a set schedule. The <code class="docutils literal"><span class="pre">Actions</span></code> element allows you
to specify these actions and when they occur.</p>
<p>The <code class="docutils literal"><span class="pre">Actions</span></code> element contains one or more <code class="docutils literal"><span class="pre">Action</span></code> elements. An
<code class="docutils literal"><span class="pre">Action</span></code> element contains an <code class="docutils literal"><span class="pre">On</span></code> element, which tells AMPS when to
perform the task, and a <code class="docutils literal"><span class="pre">Do</span></code> element, which tells AMPS what task to
perform.</p>
<div class="section" id="configuration-for-actions">
<span id="ug-actions-config"></span><h2>Configuration for Actions<a class="headerlink" href="#configuration-for-actions" title="Permalink to this headline">¶</a></h2>
<p>This section lists configuration parameters for actions.</p>
<div class="section" id="on-element-when-an-action-runs">
<span id="ug-on-actions"></span><h3>On Element: When an Action Runs<a class="headerlink" href="#on-element-when-an-action-runs" title="Permalink to this headline">¶</a></h3>
<p>This section describes the options for configuring when AMPS runs a
given action.</p>
<div class="section" id="running-an-action-on-a-schedule">
<span id="ug-actions-on-schedule"></span><h4>Running an Action on a Schedule<a class="headerlink" href="#running-an-action-on-a-schedule" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the <code class="docutils literal"><span class="pre">amps-action-on-schedule</span></code> module for running actions
on a specified schedule.</p>
<p>The options provided to the module define the schedule on which AMPS
will run the actions in the Do element.</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Every</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies a recurring action that runs whenever the time
matches the provided specification. Specifications can
take three forms:</p>
<ul class="simple">
<li><em>Timer action</em>. A specification that is simply a
duration, such as <code class="docutils literal"><span class="pre">4h</span></code> or <code class="docutils literal"><span class="pre">1d</span></code>, creates a timer
action. AMPS starts the timer when the instance starts.
When the timer expires, AMPS runs the action and resets
the timer.</li>
<li><em>Daily action</em>. A specification that is a time of day,
such as <code class="docutils literal"><span class="pre">00:32</span></code> or <code class="docutils literal"><span class="pre">17:47</span></code>, creates a daily action.
AMPS runs the action every day at the specified time.
AMPS uses a 24 hour notation for daily actions.</li>
<li><em>Weekly action</em>. A specification that includes a day of
the week and a time, such as <code class="docutils literal"><span class="pre">Saturday</span> <span class="pre">at</span> <span class="pre">11:00</span></code> or
<code class="docutils literal"><span class="pre">Wednesday</span> <span class="pre">at</span> <span class="pre">03:32</span></code> creates a weekly action. AMPS
runs the action each week on the day specified, at the
time specified. AMPS uses a 24 hour notation for weekly
actions.</li>
</ul>
<p class="last">AMPS accepts both local time and UTC for time
specifications. To use UTC, append a <code class="docutils literal"><span class="pre">Z</span></code> to the time
specifier. For example, the time specification <code class="docutils literal"><span class="pre">11:32</span></code>
is 11:32 AM local time. The time specification <code class="docutils literal"><span class="pre">11:32Z</span></code>
is 11:32 AM UTC.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Name</span></code></td>
<td><p class="first">The name of the schedule. This name appears in log
messages related to this schedule.</p>
<p class="last">Default: <code class="docutils literal"><span class="pre">unknown</span></code></p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.1:</strong> <em>Parameters for Scheduling Actions</em></p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="running-an-action-in-response-to-a-signal">
<span id="ug-actions-on-signal"></span><h4>Running an Action in Response to a Signal<a class="headerlink" href="#running-an-action-in-response-to-a-signal" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the <code class="docutils literal"><span class="pre">amps-action-on-signal</span></code> module for running actions
when AMPS receives a specified signal.</p>
<p>The module requires the <code class="docutils literal"><span class="pre">Signal</span></code> parameter:</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Signal</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the signal to respond to. This module supports the
standard Linux signals. Configuring an action uses the
standard name of the signal.</p>
<p>For example, to configure an action to <code class="docutils literal"><span class="pre">SIGUSR1</span></code>, the
value for the <code class="docutils literal"><span class="pre">Signal</span></code> element is <code class="docutils literal"><span class="pre">SIGUSR1</span></code>. To
configure an action for <code class="docutils literal"><span class="pre">SIGHUP</span></code>, the value for the
<code class="docutils literal"><span class="pre">Signal</span></code> element is <code class="docutils literal"><span class="pre">SIGHUP</span></code> and so on.</p>
<p class="last">AMPS reserves <code class="docutils literal"><span class="pre">SIGQUIT</span></code> for producing minidumps, and does
not allow this module to override <code class="docutils literal"><span class="pre">SIGQUIT</span></code>. AMPS
registers actions for several signals by default. See
<a class="reference internal" href="#ug-actions-default-signal"><span class="std std-ref">Default Signal Actions</span></a>
for details.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.2:</strong> <em>Parameters for Responding to Signals</em></p>
<p>This module does not add any variables to the AMPS context.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="caution" src="../_images/caution.svg" /></td>
<td>Actions can be used to override the default signal behavior for
AMPS.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="default-signal-actions">
<span id="ug-actions-default-signal"></span><h4>Default Signal Actions<a class="headerlink" href="#default-signal-actions" title="Permalink to this headline">¶</a></h4>
<p id="index-0">By default, AMPS registers the following actions for signals.</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">On Event</th>
<th class="head">Action</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SIGUSR1</span></code></td>
<td><code class="docutils literal"><span class="pre">amps-action-do-disable-authentication</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SIGUSR1</span></code></td>
<td><code class="docutils literal"><span class="pre">amps-action-do-disable-entitlement</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SIGUSR2</span></code></td>
<td><code class="docutils literal"><span class="pre">amps-action-do-enable-authentication</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SIGUSR2</span></code></td>
<td><code class="docutils literal"><span class="pre">amps-action-do-enable-entitlement</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SIGINT</span></code></td>
<td><code class="docutils literal"><span class="pre">amps-action-do-shutdown</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">SIGTERM</span></code></td>
<td><code class="docutils literal"><span class="pre">amps-action-do-shutdown</span></code></td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SIGHUP</span></code></td>
<td><code class="docutils literal"><span class="pre">amps-action-do-shutdown</span></code></td>
</tr>
</tbody>
</table>
<p><strong>Table 14.3:</strong> <em>Default Actions</em></p>
<p>The actions in the table above can be be overridden by creating an
explicit action in the configuration file.</p>
<p id="index-1">AMPS reserves the <code class="docutils literal"><span class="pre">SIGQUIT</span></code> signal, and does not allow the
configuration file to override the action taken in response
to <code class="docutils literal"><span class="pre">SIGQUIT</span></code>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">On Event</th>
<th class="head">Action</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">SIGQUIT</span></code></td>
<td><code class="docutils literal"><span class="pre">amps-action-do-minidump</span></code></td>
</tr>
</tbody>
</table>
<p><strong>Table 14.4:</strong> <em>Reserved signal</em></p>
</div>
<div class="section" id="running-an-action-on-startup-or-shutdown">
<span id="ug-actions-on-startup"></span><h4>Running an Action on Startup or Shutdown<a class="headerlink" href="#running-an-action-on-startup-or-shutdown" title="Permalink to this headline">¶</a></h4>
<p>AMPS includes modules to run actions when AMPS starts up or shuts down.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-startup</span></code> module runs actions as the last step in
the startup sequence. The <code class="docutils literal"><span class="pre">amps-action-on-shutdown</span></code> module runs
actions as the first step in the AMPS shutdown sequence.</p>
<p>In both cases, actions run in the order that the actions appear in the
configuration file.</p>
<p>These modules do not require any parameters.</p>
<p>These modules do not add any variables to the AMPS context.</p>
</div>
<div class="section" id="running-an-action-on-client-logon">
<span id="ug-actions-on-client-logon"></span><h4>Running an Action on Client Logon<a class="headerlink" href="#running-an-action-on-client-logon" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the <code class="docutils literal"><span class="pre">amps-action-on-logon-client</span></code> module for running actions
when a user logs into an AMPS client.</p>
<p>This module does not require any parameters.</p>
<p>This module adds the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_CLIENT_NAME</span></code></td>
<td>The name of the AMPS client.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_CONNECTION_NAME</span></code></td>
<td>The name of the AMPS connection.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_AUTHENTICATION_ID</span></code></td>
<td>The authentication id of the AMPS connection.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.5:</strong> <em>Context Variables for On Client Logon</em></p>
</div>
<div class="section" id="running-an-action-on-client-connection">
<span id="ug-actions-on-client-connection"></span><h4>Running an Action on Client Connection<a class="headerlink" href="#running-an-action-on-client-connection" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides modules for running actions on the connection or
disconnection of an AMPS client.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-disconnect-client</span></code> runs actions once an AMPS
client instance disconnects. The <code class="docutils literal"><span class="pre">amps-action-on-connect-client</span></code> runs
actions once an instance of an AMPS client successfully connects.</p>
<p>These modules do not require any parameters.</p>
<p>These modules add the following variables to the AMPS context.</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_CLIENT_NAME</span></code></td>
<td>The name of the AMPS client.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_CONNECTION_NAME</span></code></td>
<td>The name of the AMPS connection.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_AUTHENTICATION_ID</span></code></td>
<td>The authentication id of the AMPS connection.
(for <code class="docutils literal"><span class="pre">on-disconnect-client</span></code> action only)</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.6:</strong> <em>Context Variables for On Connect and Disconnect Client</em></p>
</div>
<div class="section" id="running-an-action-on-message-delivery">
<span id="ug-actions-on-message-delivery"></span><h4>Running an Action on Message Delivery<a class="headerlink" href="#running-an-action-on-message-delivery" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides modules to run actions when AMPS delivers a message to
subscribers. The basic flow of AMPS messaging is to first receive a
published message, find the subscriber(s) to which this message will be
sent, then deliver the message.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-deliver-message</span></code> runs actions when AMPS delivers a
<code class="docutils literal"><span class="pre">publish</span></code> message to subscribers.</p>
<p>This module requires the <code class="docutils literal"><span class="pre">MessageType</span></code> and the <code class="docutils literal"><span class="pre">Topic</span></code> of the
message that has been delivered:</p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The message type of the topic to monitor for message
delivery. There is no default for this parameter.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td>The name of the topic to monitor for message delivery.
This parameter supports regular expressions. There is no
default for this parameter.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.7:</strong> <em>Parameters for On Deliver Message</em></p>
<p>This module adds the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TOPIC</span></code></td>
<td>The topic of the message.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_DATA</span></code></td>
<td>The data the message contains.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_DATA_LENGTH</span></code></td>
<td>The length of the data the message
contains.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_BOOKMARK</span></code></td>
<td>The bookmark associated with this message.
This is an empty string if the message does
not have a bookmark.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_CLIENT_NAME</span></code></td>
<td>The name of the client to which this
message was delivered.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_CORRELATION_ID</span></code></td>
<td>The correlation id set on the publish command,
if one was set.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.8:</strong> <em>Context Variables for On Deliver Message</em></p>
</div>
<div class="section" id="running-an-action-on-message-publish">
<span id="ug-actions-on-message-publish"></span><h4>Running an Action on Message Publish<a class="headerlink" href="#running-an-action-on-message-publish" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides modules to run actions when a message is published to
AMPS. The basic flow of AMPS messaging is to first receive a published
message, find the subscriber(s) to which this message will be sent, then
deliver that message to the subscriber(s).</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-publish-message</span></code> runs actions as soon as a message
is published to AMPS.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="warning" src="../_images/warning.svg" /></td>
<td><p class="first">This action is treated by the AMPS engine as a subscription from
an internal AMPS client.</p>
<p class="last">When working with queues, use this action with the <em>underlying
topic</em> of the queue rather than the queue topic itself. Because
this action creates a subscription, using this action with the
queue topic will cause the action to lease messages from the
queue even though the action does <em>not</em> acknowledge messages.
This means that, when used with the queue topic itself,
the action will interfere with other subscribers and, depending
on the queue configuration, may only receive one message during
the lifetime of the instance.</p>
</td>
</tr>
</tbody>
</table>
<p>This module requires the <code class="docutils literal"><span class="pre">MessageType</span></code> and the <code class="docutils literal"><span class="pre">Topic</span></code> of the
message that was published. In addition to that, this module also
accepts optional parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The message type of the topic to monitor for
publishes. There is no default for this parameter.</td>
</tr>
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td>The name of the topic to monitor for publishes. This
parameter supports regular expressions. There is no
default for this parameter.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">MessageSource</span></code></td>
<td><p class="first">The source to monitor for publishes. The source of
the message defaults to <code class="docutils literal"><span class="pre">all</span></code>, which monitors both
publishes directly to this AMPS instance and
messages received via replication.</p>
<p class="last">This parameter also accepts <code class="docutils literal"><span class="pre">local</span></code> for when the
message source is published directly to this AMPS
instance and <code class="docutils literal"><span class="pre">replicated</span></code> for messages received
via replication.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Filter</span></code></td>
<td>Sets the filter to apply. Only messages that match
this filter will cause the action to run.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Options</span></code></td>
<td>Sets the options to apply when listening for
messages. This action supports any option that would
be supported by the <cite>subscribe</cite> command when not
using a bookmark.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.9:</strong> <em>Parameters for On Publish Message</em></p>
<p>This module adds the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TOPIC</span></code></td>
<td>The topic of the message.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_DATA</span></code></td>
<td>The data the message contains.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_DATA_LENGTH</span></code></td>
<td>The length of the data that the
message contains.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_BOOKMARK</span></code></td>
<td>The bookmark associated with this
message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TIMESTAMP</span></code></td>
<td>The time at which the message was
processed by AMPS.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_CLIENT_NAME</span></code></td>
<td>The name of the client from which
the message was published.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.10:</strong> <em>Context Variables for On Publish Message</em></p>
</div>
<div class="section" id="running-an-action-on-oof-message">
<span id="ug-actions-on-oof-message"></span><h4>Running an Action on OOF Message<a class="headerlink" href="#running-an-action-on-oof-message" title="Permalink to this headline">¶</a></h4>
<p>When a record that previously matched a subscription has been updated so
that the record no longer matches its subscription, AMPS sends an
out-of-focus (OOF) message to let subscribers know that their record no
longer matches the subscription. With <code class="docutils literal"><span class="pre">amps-action-on-oof-message</span></code>,
you can enter a subscription within AMPS and run actions when an OOF
message for that subscription is produced.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="warning" src="../_images/warning.svg" /></td>
<td><p class="first">This action is treated by the AMPS engine as a subscription from
an internal AMPS client.</p>
<p>Do not use this action with queue topics. Because
this action creates a subscription, using this action with the
queue topic will cause the action to lease messages from the
queue even though the action does <em>not</em> acknowledge messages.
This means that, when used with the queue topic itself,
the action will interfere with other subscribers and, depending
on the queue configuration, may only receive one message during
the lifetime of the instance.</p>
<p class="last">Furthermore, because each publish to a queue topic is treated
as a distinct message, a subscription to a queue topic
will never produce <code class="docutils literal"><span class="pre">oof</span></code> messages.</p>
</td>
</tr>
</tbody>
</table>
<p>This module requires the following parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The message type of the topic to monitor for OOF messages. This parameter supports
regular expressions. There is no default for this  parameter.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td><p class="first">The topic to monitor for OOF messages.The topic specified must be a SOW topic,
view, or conflated topic. This parameter supports regular expressions. There is no
default for this parameter.</p>
<p class="last">This module should not be used with queue topics.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Filter</span></code></td>
<td>Set the filter to apply. This filter forms the internal subscription for which OOF
messages will be generated.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Type</span></code></td>
<td><p class="first">The type of OOF message to take action on.</p>
<ul class="simple">
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">match</span></code> Take action on OOF messages generated because message no longer</dt>
<dd>matches filter.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">delete</span></code> Take action on OOF messages generated because message has been</dt>
<dd>removed from the SOW.</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt><code class="docutils literal"><span class="pre">expire</span></code> Take action on OOF messages generated because the message expired</dt>
<dd>from the SOW.</dd>
</dl>
</li>
<li><code class="docutils literal"><span class="pre">all</span></code> Take action on all of the above types.</li>
</ul>
<p class="last">Defaults to <code class="docutils literal"><span class="pre">all</span></code>.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.11:</strong> <em>Parameters for On OOF Message</em></p>
<p>This module adds the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="57%" />
<col width="43%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TOPIC</span></code></td>
<td>The topic of the OOF message.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_DATA</span></code></td>
<td>The data of the OOF message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_DATA_LENGTH</span></code></td>
<td>The length of the data of the
OOF message.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_PREVIOUS_DATA</span></code></td>
<td>The data previously contained
from the updated record.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_PREVIOUS_DATA_LENGTH</span></code></td>
<td>The length of the data
previously contained from the
updated record.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.12:</strong> <em>Context Variables for On OOF Message</em></p>
</div>
<div class="section" id="running-an-action-on-minidump">
<span id="ug-actions-on-minidump"></span><h4>Running an Action on Minidump<a class="headerlink" href="#running-an-action-on-minidump" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the <code class="docutils literal"><span class="pre">amps-action-on-minidump</span></code> module for running actions
when AMPS generates a minidump.</p>
<p>This module does not require parameters.</p>
<p>This module adds the following variable to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="43%" />
<col width="57%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_MINIDUMP_PATH</span></code></td>
<td>The path to where the minidump is
created.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.13:</strong> <em>Context Variable for On Minidump</em></p>
</div>
<div class="section" id="running-an-action-on-offline-start-or-stop">
<span id="ug-actions-on-offline-start"></span><h4>Running an Action on Offline Start or Stop<a class="headerlink" href="#running-an-action-on-offline-start-or-stop" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides modules to run actions when an AMPS client is marked as a
slow client, and also for when the AMPS client catches up to no longer
be subject to slow client offlining.</p>
<p>Slow client offlining is a feature in AMPS that reduces the memory
resources consumed by slow clients. More on this feature can be found in
<a class="reference external" href="../../../user-guide/html/chapters/ha.html#slow-client-management">Slow Client Management and Capacity Limits in the AMPS User Guide</a>.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-offline-start</span></code> module runs actions as the first
step when AMPS&#8217;s result set reaches its disk limit and has to disconnect
the client. The <code class="docutils literal"><span class="pre">amps-action-on-offline-stop</span></code> module runs actions as
AMPS is no longer subject to slow client offlining.</p>
<p>In both cases, actions run in the order that the actions appear in the
configuration file.</p>
<p>Both modules do not require any parameters.</p>
<p>Both modules add the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_CLIENT_NAME</span></code></td>
<td>The name of the AMPS client.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_CONNECTION_NAME</span></code></td>
<td>The name of the AMPS connection.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.14:</strong> <em>Context Variables for On Offline Start and Stop</em></p>
</div>
<div class="section" id="running-an-action-on-sow-message-deletion">
<h4>Running an Action on SOW Message Deletion<a class="headerlink" href="#running-an-action-on-sow-message-deletion" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides a module to run an action when a message is deleted from a
topic in the SOW.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-sow-delete-message</span></code> module monitors a topic for
deletions from the SOW. The action runs once for each message that is
deleted in the matching topic.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The message type of the topic to monitor for
messages. There is no default for this parameter.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td>The name of the topic to monitor for messages. This
parameter <em>does not</em> support regular expressions.
The topic name must be one of the topics in the SOW
(either a topic in the SOW, a view, a conflated
topic, or a queue). There is no default for this
parameter.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.15:</strong> <em>Parameters for On SOW Message Deletion</em></p>
<p>The module adds the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TOPIC</span></code></td>
<td>The topic of the message that
expired the alert.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_DATA</span></code></td>
<td>The current data of the message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_DATA_LENGTH</span></code></td>
<td>The length of the current data of
the message, in bytes.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_CORRELATION_ID</span></code></td>
<td>The correlation id set on the publish command,
if one was set.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.16:</strong> <em>Context Variables for On SOW Message Delete</em></p>
</div>
<div class="section" id="running-an-action-on-sow-message-expiration">
<h4>Running an Action on SOW Message Expiration<a class="headerlink" href="#running-an-action-on-sow-message-expiration" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides a module to run an action when a message expires from a
topic in the SOW.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-sow-expire-message</span></code> module monitors a topic for
expirations. The action runs once for each message that expires in the
matching topic. Notice, in particular, that this includes monitoring
messages that expire from the queue, which are presented as SOW
expirations to this module.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The message type of the topic to monitor for
messages. There is no default for this parameter.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td>The name of the topic to monitor for messages. This
parameter <em>does not</em> support regular expressions.
The topic name must be one of the topics in the SOW
(either a topic in the SOW, a view, a conflated
topic, or a queue). There is no default for this
parameter.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Reason</span></code></td>
<td>An optional comma-delimited string indicating the
expiration reasons to monitor for. For example,
setting this to <code class="docutils literal"><span class="pre">time_limit,forced_expire</span></code> will
cause this action to be invoked only when the
expiration reason includes one of <code class="docutils literal"><span class="pre">time_limit</span></code> or
<code class="docutils literal"><span class="pre">forced_expire</span></code>. For more information on the
allowed values and definitions, see the
documentation for <code class="docutils literal"><span class="pre">AMPS_REASON</span></code> below.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.17:</strong> <em>Parameters for On SOW Message Expiration</em></p>
<p>The module adds the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TOPIC</span></code></td>
<td>The topic of the message that
expired the alert.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_DATA</span></code></td>
<td>The current data of the message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_DATA_LENGTH</span></code></td>
<td>The length of the current data of
the message, in bytes.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_REASON</span></code></td>
<td><p class="first">A comma-delimited string indicating
one or more reason(s) the message was
expired. This string contains one or
more of the following values:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">time_limit</span></code>: The expiration
time for this message or topic has
passed.</li>
<li><code class="docutils literal"><span class="pre">forced_expire</span></code>: This queue
message was acknowledged with a
<code class="docutils literal"><span class="pre">expire</span></code> option resulting in the
message&#8217;s immediate removal.</li>
<li><code class="docutils literal"><span class="pre">max_cancels</span></code>: This queue message
was acknowledged with a <code class="docutils literal"><span class="pre">cancel</span></code>
option, and the number of cancels
exceeded the queue&#8217;s configured
<code class="docutils literal"><span class="pre">MaxCancels</span></code> limit.</li>
<li><code class="docutils literal"><span class="pre">max_deliveries</span></code>: This queue
message was not successfully
acknowledged by a subscriber, and
the number of deliveries has
exceeded the queue&#8217;s
<code class="docutils literal"><span class="pre">MaxDeliveries</span></code> limit.</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_CORRELATION_ID</span></code></td>
<td>The correlation id set on the
publish command if one was set.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.18:</strong> <em>Context Variables for On SOW Message Expire</em></p>
</div>
<div class="section" id="running-an-action-on-message-state-change">
<span id="actions-on-alert"></span><h4>Running an Action on Message State Change<a class="headerlink" href="#running-an-action-on-message-state-change" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides two modules to run an action when a message in a SOW topic
meets a specific condition for longer than a specified period of time.
This module provides a way to track specific messages in a SOW topic
and indicate whether the message has timed out (that is, been in the
monitored state longer than expected) or whether the message has
been processed as expected and is no longer being tracked within
the specified timeout.</p>
<p>The other module, <code class="docutils literal"><span class="pre">amps-action-on-message-condition-timeout</span></code>
tracks a message for timeout purposes, but does not trigger an
event if the message is no longer being tracked. Use that module
to keep track of timeouts. Use this module if both conditions
are important. Use <code class="docutils literal"><span class="pre">amps-action-on-message-condition-timeout</span></code>
if only timeouts are important.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-alert</span></code> action monitors a SOW topic
for messages that match a filter and triggers an action when either:</p>
<ul class="simple">
<li>The message has remained matched on the filter for at least the
specified duration (indicating a timeout), <em>or</em></li>
<li>An out-of-focus message is received for the message
(indicating that the message is no longer tracked)</li>
</ul>
<p>For example, a set of actions might be configured to publish a message
to an <code class="docutils literal"><span class="pre">Alerts</span></code> topic if an order is unprocessed for more than a specified
timeout. When the order is processed, the actions might publish a message
to a <code class="docutils literal"><span class="pre">Statistics</span></code> topic for tracking purposes. Rather than creating
two independent actions, which could lead to overlap if the order is
processed at the same time that the alert is being generated, use
this action to guarantee that only one of the events will be generated.</p>
<p>The module tracks each message that matches the filter individually, and
will run once for each message tracked.</p>
<p>This module uses the Out-of-Focus notification (OOF) mechanism. When a
message matches the specified topic and filter, the module begins
tracking that message. If no OOF notification is received for that
message within the specified timeout, the action runs for that message
and indicates that the timeout has been exceeded. If an OOF notification
is received before the timeout expires, then the action runs for that
message, indicating that the message is no longer tracked.</p>
<p>This module uses the custom event system as a way of indicating whether
a given message was removed from tracking, or whether the message timed
out. When configuring the action, you specify the event to raise for
each of these states. This module stores the exact event raised in a
context variable, which you can then use with <code class="docutils literal"><span class="pre">amps-action-do-event</span></code>
to raise the event.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="caution" src="../_images/caution.svg" /></td>
<td>While the AMPS server is running, this action will trigger
exactly once for each message after it reaches the timeout
period. When AMPS restarts, if a message that had previously
triggered this action still exists in the SOW topic (and still
matches the filter provided, if any), the action will run for
that message immediately after module initializes on restart.</td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="line-block">
<div class="line"><br /></div>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The message type of the topic to monitor for
messages. There is no default for this parameter.</td>
</tr>
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td>The name of the topic to monitor for messages. This
parameter <em>does not</em> support regular expressions.
The topic name must be one of the topics in the SOW
(either a topic in the SOW, a view, or a conflated
topic). Queues are not supported. There is no
default for this parameter.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">OOFEvent</span>
</pre></div>
</div>
</td>
<td><p class="first">The value to store when an out-of-focus notification
is received for a tracked message.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">TimeoutEvent</span>
</pre></div>
</div>
</td>
<td><p class="first">The value to store when a message is in the tracked
state for longer than the timeout period.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">EventVariable</span>
</pre></div>
</div>
</td>
<td><p class="first">The name of the context variable in which to store
the reason that the action is running (either the
string in  <code class="docutils literal"><span class="pre">OOFEvent</span></code> or the string in
<code class="docutils literal"><span class="pre">TimeoutEvent</span></code>).</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Duration</span></code></td>
<td>The amount of time to wait for an OOF notification
for the message before running the action.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Filter</span></code></td>
<td>Sets the filter to apply. Only messages that match
this filter will be monitored by this action. If no
filter is provided, every message of the specified
message type in topics that match the <code class="docutils literal"><span class="pre">Topic</span></code>
value will be monitored.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.19:</strong> <em>Parameters for On Alert</em></p>
<p>The module adds the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TOPIC</span></code></td>
<td>The topic of the message that
triggered the alert.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_DATA</span></code></td>
<td>The current data of the message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_DATA_LENGTH</span></code></td>
<td>The length of the current data of
the message, in bytes.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_BOOKMARK</span></code></td>
<td>The bookmark of the message. Empty
if there is no bookmark for the
message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TIMESTAMP</span></code></td>
<td>The timestamp at which the module
began tracking the message.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_CLIENT_NAME</span></code></td>
<td>The client name of the current value
of the message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_SOW_KEY</span></code></td>
<td>The current SowKey for the message.</td>
</tr>
<tr class="row-odd"><td>the variable specified in
<code class="docutils literal"><span class="pre">EventVariable</span></code></td>
<td>The reason the action is running.
This will be either the value of
<code class="docutils literal"><span class="pre">OOFEvent</span></code> or the value of
<code class="docutils literal"><span class="pre">TimeoutEvent</span></code>, depending on what
caused the action to run.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.20:</strong> <em>Context Variables for On Alert</em></p>
</div>
<div class="section" id="running-an-action-on-message-condition-timeout">
<span id="actions-on-message-status-timeout"></span><h4>Running an Action on Message Condition Timeout<a class="headerlink" href="#running-an-action-on-message-condition-timeout" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides a module to run an action when a message in a SOW topic
meets a specific condition for longer than a specified period of time.
For example, an action might be configured to publish a message to an
<code class="docutils literal"><span class="pre">Alerts</span></code> topic if an order is unprocessed for more than a specified
timeout.</p>
<p>AMPS also provides a module, <code class="docutils literal"><span class="pre">amps-action-on-alert</span></code>, that runs
when <em>either</em> a message has been in a specific condition for a
longer than expected period of time, or the module receives an
out-of-focus notification indicating that the message no longer
meets the tracking condition.  Use that module if both
conditions are important. Use this module if it is only important
to track timeouts.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-on-message-condition-timeout</span></code> monitors a SOW topic
for messages that match a filter and triggers an action for each message
that remains matched on that filter for at least the specified duration.</p>
<p>This module uses the Out-of-Focus notification (OOF) mechanism. When a
message matches the specified topic and filter, the module begins
tracking that message. If no OOF notification is received for that
message within the specified timeout, the action runs for that message.</p>
<p>The module tracks each message that matches the filter individually, and
will run once for each message that exceeds the timeout.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="caution" src="../_images/caution.svg" /></td>
<td>While the AMPS server is running, this action will trigger
exactly once for each message after it reaches the timeout
period. When AMPS restarts, if a message that had previously
triggered this action still exists in the SOW topic (and still
matches the filter provided, if any), the action will run for
that message immediately after module initializes on restart.</td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="line-block">
<div class="line"><br /></div>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The message type of the topic to monitor for
messages. There is no default for this parameter.</td>
</tr>
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td>The name of the topic to monitor for messages. This
parameter <em>does not</em> support regular expressions.
The topic name must be one of the topics in the SOW
(either a topic in the SOW, a view, or a conflated
topic). Queues are not supported. There is no
default for this parameter.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Duration</span></code></td>
<td>The amount of time to wait for an OOF notification
for the message before running the action.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Filter</span></code></td>
<td>Sets the filter to apply. Only messages that match
this filter will be monitored by this action. If no
filter is provided, every message of the specified
message type in topics that match the <code class="docutils literal"><span class="pre">Topic</span></code>
value will be monitored.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.21:</strong> <em>Parameters for On Message Condition Timeout</em></p>
<p>The module adds the following variables to the AMPS context:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Variable</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TOPIC</span></code></td>
<td>The topic of the message that
triggered the alert.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_DATA</span></code></td>
<td>The current data of the message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_DATA_LENGTH</span></code></td>
<td>The length of the current data of
the message, in bytes.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_BOOKMARK</span></code></td>
<td>The bookmark of the message. Empty
if there is no bookmark for the
message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_TIMESTAMP</span></code></td>
<td>The timestamp at which the module
began tracking the message.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AMPS_CLIENT_NAME</span></code></td>
<td>The client name of the current value
of the message.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">AMPS_SOW_KEY</span></code></td>
<td>The current SowKey for the message.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.22:</strong> <em>Context Variables for On Message Condition Timeout</em></p>
</div>
<div class="section" id="running-an-action-on-a-custom-event">
<span id="actions-on-event"></span><h4>Running an Action on a Custom Event<a class="headerlink" href="#running-an-action-on-a-custom-event" title="Permalink to this headline">¶</a></h4>
<p>The AMPS action system provides a way to create custom events and run an
action when the custom event is raised. The <code class="docutils literal"><span class="pre">amps-action-on-execute-event</span></code>
action runs when a specified custom event is raised by the
<code class="docutils literal"><span class="pre">amps-action-do-execute-event</span></code> action.</p>
<p>This action takes a single parameter:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Event</span>
</pre></div>
</div>
</td>
<td><p class="first">The value to watch for. When an event with this name
is raised, the action runs.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.23:</strong> <em>Parameters for On Execute Event</em></p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
</div>
<div class="section" id="do-element-defining-the-action-to-take">
<span id="ug-do-actions"></span><h3>Do Element: Defining the Action to Take<a class="headerlink" href="#do-element-defining-the-action-to-take" title="Permalink to this headline">¶</a></h3>
<p>This section describes the default modules for specifying what AMPS does
when an action runs.</p>
<div class="section" id="rotate-log-files">
<span id="ug-actions-do-log"></span><h4>Rotate Log Files<a class="headerlink" href="#rotate-log-files" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the following module for rotating log files. AMPS loads
this module by default:</p>
<table border="1" class="docutils">
<colgroup>
<col width="31%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-rotate-logs</span></code></td>
<td><p class="first">Rotates logs that are older than a specified age, for log types that
support log rotation. Rotating a log involves closing the log and
opening the next log in sequence.</p>
<p class="last">AMPS will use the name specifier provided in the AMPS configuration
for the new log file. This may overwrite the current log file if the
specifier results in the same name as the current log file.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.24:</strong> <em>Managing Logs</em></p>
<p>This module does not require options.</p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="manage-the-statistics-database">
<span id="ug-actions-do-stats"></span><h4>Manage the Statistics Database<a class="headerlink" href="#manage-the-statistics-database" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the following modules for managing the statistics
database. As a maintenance strategy, 60East recommends truncating
statistics on a regular basis. This frees space in the database file,
which will be reused as new statistics are generated.</p>
<p>60East does not typically recommend using the vacuum action. It is
generally not necessary to vacuum statistics unless you have changed your
retention policy so that less data is retained between truncation
operations. With regular truncation, the statistics database file will
usually stabilize at the correct size to hold the amount of data your
application generates between truncation operations.</p>
<p>AMPS loads these modules by default.</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-truncate-statistics</span></code></td>
<td>Removes statistics that are older than a specified age. This
frees space in the statistics file, but does not reduce the
size of the file.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps-action-do-vacuum-statistics</span></code></td>
<td><p class="first">Remove unused space in the statistics file to reduce the
size of the file. <em>The Admin interface will be unavailable
while this action is running.</em></p>
<p>In general, it is not necessary to remove unused space in
the statistics file. This operation can be expensive, and
query access to the statistics database can be unavailable
for an extended period of time if the file is large. If
storage space is in high demand, and the interval at which
the file is vacuumed has been reduced, removing space from
the file can sometimes reduce the space needs.</p>
<p>Typically, this action would only be used for instances
that have wide variations in traffic, that are not
closely monitored, and where the performance impact of
vacuuming the statistics is unimportant, such as
a shared development environment designed for minimal
administration. This action is not typically recommended
for a production system.</p>
<table border="1" class="last docutils">
<colgroup>
<col width="21%" />
<col width="79%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="warning" src="../_images/warning.svg" /></td>
<td><p class="first">60East does not recommend this action in
most cases.</p>
<p class="last">60East recommends using this action only
in long-running AMPS environments where
space is at a premium, and scheduling the
action during times when it is acceptable
for monitoring of the system to be
unavailable while the file is processed.
<em>This action can cause AMPS to appear to
be unresponsive for an extended period
of time</em>.</p>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.25:</strong> <em>Managing Statistics</em></p>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-truncate-statistics</span></code> module requires an <code class="docutils literal"><span class="pre">Age</span></code>
parameter that specifies the age of the statistics to process.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Age</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the age of the statistics to remove. The
module processes any file older than the specified
<code class="docutils literal"><span class="pre">Age</span></code>. For example, when the <code class="docutils literal"><span class="pre">Age</span></code> is <code class="docutils literal"><span class="pre">5d</span></code>,
the module removes statistics that are older than
5d.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.26:</strong> <em>Parameters for Managing Statistics</em></p>
<p>These modules do not add any variables to the AMPS context.</p>
</div>
<div class="section" id="manage-journal-files">
<span id="ug-actions-do-journal"></span><h4>Manage Journal Files<a class="headerlink" href="#manage-journal-files" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the following modules for managing journal files. AMPS loads these modules by default:</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-archive-journal</span></code></td>
<td>Archives journal files that are older than a specified age to
the <code class="docutils literal"><span class="pre">JournalArchiveDirectory</span></code> specified for the transaction
log.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps-action-do-compress-journal</span></code></td>
<td>Compresses journal files that are older than a specified age.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-remove-journal</span></code></td>
<td>Deletes journal files that are older than a specified age.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.27:</strong> <em>Managing Journals</em></p>
<p>Each of these modules requires an <code class="docutils literal"><span class="pre">Age</span></code> parameter that specifies the age of the journal files to process.</p>
<p>AMPS will only remove journal files that are no longer needed by the
instance. AMPS ensures that all replays from a journal file are
complete, all queue messages in that journal file have been delivered
(and acknowledged, if required), and all messages from a journal file
have been successfully replicated before removing the file.</p>
<p>Journal files that have been compressed or archived (or both) are still
part of the transaction log. AMPS will compress and
archive journal files that have undelivered queue messages,
or that have not yet been fully replicated, and so on.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Age</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the age of files to process. The module
processes any file older than the specified <code class="docutils literal"><span class="pre">Age</span></code>.
For example, when the <code class="docutils literal"><span class="pre">Age</span></code> is <code class="docutils literal"><span class="pre">5d</span></code>, only files
that have not been written to for longer than 5 days
will be processed by the module.</p>
<p>AMPS does not remove the current journal file, or
files that are being used for replay, files that are
being used for replication, or files that contain
unacknowledged and unexpired messages in a queue;
even if the file is older than the <code class="docutils literal"><span class="pre">Age</span></code> parameter.
parameter.</p>
<p>AMPS does not allow gaps in the journal
files, so it will only remove a given file if all
previous files have been removed.</p>
<p>AMPS can compress and archive journal files that are
still in use, since compresssed or archived journal
files are part of the transaction log and AMPS
will replay messages from these files.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.28:</strong> <em>Parameters for Managing Journals</em></p>
<p>These modules do not add any variables to the AMPS context.</p>
</div>
<div class="section" id="compressing-files">
<h4>Compressing Files<a class="headerlink" href="#compressing-files" title="Permalink to this headline">¶</a></h4>
<p id="ug-actions-compress-files">AMPS provides the following module for compressing files. Use this action
to compress error log files that are no longer needed. AMPS loads this module
by default. This action cannot be used to safely compress journal files
(also known as transaction log files). For those files, use the
journal management actions described in
<a class="reference internal" href="#ug-actions-do-journal"><span class="std std-ref">Manage Journal Files</span></a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="caution" src="../_images/caution.svg" /></td>
<td>This action compresses files that match an arbitrary pattern. If
the pattern is not specified carefully, this action can compress
files that contain important data, are required for AMPS, or are
required by the operating system.</td>
</tr>
</tbody>
</table>
<div class="line-block">
<div class="line"><br /></div>
</div>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="caution" src="../_images/caution.svg" /></td>
<td>This action cannot be used to safely compress journal files. Use
the actions in <a class="reference internal" href="#ug-actions-do-journal"><span class="std std-ref">Manage Journal</span></a> to
manage journal files.</td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="line-block">
<div class="line"><br /></div>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="35%" />
<col width="65%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-compress-files</span></code></td>
<td><p class="first">Compresses files that match the specified pattern that are
older than the specified age. This action accepts an arbitrary
pattern, and removes files that match that pattern. While AMPS
attempts to protect against deleting journal files, using a
pattern that removes files that are critical for AMPS, for the
application, or for the operating system may result in loss of
data.</p>
<p>The module does not recurse into directories. It skips open
files. The module does not compress AMPS journals (that is,
files  that end with a <code class="docutils literal"><span class="pre">.journal</span></code> extension), and reports
an error if a file with that extension matches the specified
<code class="docutils literal"><span class="pre">Pattern</span></code>.</p>
<p class="last">The commands to remove files are executed with the current
permissions of the AMPS process.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.29:</strong> <em>Compressing Files</em></p>
<p>This module requires an <code class="docutils literal"><span class="pre">Age</span></code> parameter that specifies the age of the
files to remove, as determined by the update to the file. This module
also requires a <code class="docutils literal"><span class="pre">Pattern</span></code> parameter that specifies a pattern for
locating files to remove.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Age</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the age of files to process. The module
removes any file older than the specified <code class="docutils literal"><span class="pre">Age</span></code>
that matches the specified <code class="docutils literal"><span class="pre">Pattern</span></code>. For example,
when the <code class="docutils literal"><span class="pre">Age</span></code> is <code class="docutils literal"><span class="pre">5d</span></code>, only files that have not
modified within 5 days and that match the pattern
will be processed by the module.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Pattern</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the pattern for files to remove. The
module removes any files that match the specified
<code class="docutils literal"><span class="pre">Pattern</span></code> that have not been modified more
recently than the specified <code class="docutils literal"><span class="pre">Age</span></code>.</p>
<p>This parameter is interpreted as a Unix shell
globbing pattern. It is <em>not</em> interpreted as a
regular expression.</p>
<p>As with other parameters that use the file system,
when the pattern specified is a relative path the
parameter is interpreted relative to the current
working directory of the AMPS process. When the
pattern specified is an absolute path, AMPS uses the
absolute path.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Keep</span></code></td>
<td><p class="first">Specifies the number of files that meet the Age and
Pattern criteria to leave uncompressed. When this
parameter is specified, AMPS will compress files
matching the criteria, starting with the oldest
files, and stop when the number of remaining files
is the number specified in this parameter.</p>
<p class="last">There is no default for this parameter. When both
<code class="docutils literal"><span class="pre">Keep</span></code> and <code class="docutils literal"><span class="pre">Count</span></code> are specified, AMPS will not
compress any files if the number of files meeting
the criteria is less than the number specified in
the <code class="docutils literal"><span class="pre">Keep</span></code> parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Count</span></code></td>
<td><p class="first">Specifies the maximum number of files that meet the
<code class="docutils literal"><span class="pre">Age</span></code> and <code class="docutils literal"><span class="pre">Pattern</span></code> criteria to compress. AMPS
will compress files matching the criteria, starting
with the oldest files, and stop when the number of
files specified in this parameter have been
compressed.</p>
<p class="last">There is no default for this parameter. When both
<code class="docutils literal"><span class="pre">Keep</span></code> and <code class="docutils literal"><span class="pre">Count</span></code> are specified, AMPS will not
compress any files if the number of files meeting
the criteria is less than the number specified in
the <code class="docutils literal"><span class="pre">Keep</span></code> parameter.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.30:</strong> <em>Parameters for Compressing Files</em></p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="removing-files">
<span id="ug-actions-remove-files"></span><h4>Removing Files<a class="headerlink" href="#removing-files" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the following module for removing files. Use this action
to remove error log files that are no longer needed. AMPS loads this
module by default. This action cannot be used to safely remove journal
files (also known as transaction log files). For those files, use the
journal management actions described in
<a class="reference internal" href="#ug-actions-do-journal"><span class="std std-ref">Manage Journal Files</span></a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="caution" src="../_images/caution.svg" /></td>
<td>This action removes files that match an arbitrary pattern. If
the pattern is not specified carefully, this action can remove
files that contain important data, are required for AMPS, or are
required by the operating system.</td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="line-block">
<div class="line"><br /></div>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="caution" src="../_images/caution.svg" /></td>
<td>This action cannot be used to safely remove journal files. Use
the actions in <a class="reference internal" href="#ug-actions-do-journal"><span class="std std-ref">Manage Journal</span></a> to
manage journal files.</td>
</tr>
</tbody>
</table>
<blockquote>
<div><div class="line-block">
<div class="line"><br /></div>
</div>
</div></blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-remove-files</span></code></td>
<td><p class="first">Removes files that match the specified pattern that are older
than the specified age. This action accepts an arbitrary
pattern, and removes files that match that pattern. While AMPS
attempts to protect against deleting journal files, using a
pattern that removes files that are critical for AMPS, for the
application, or for the operating system may result in loss of
data.</p>
<p>The module does not recurse into directories. It skips open
files. The module does not remove AMPS journals (that is, files
that end with a <code class="docutils literal"><span class="pre">.journal</span></code> extension), and reports an error
if a file with that extension matches the specified <code class="docutils literal"><span class="pre">Pattern</span></code>.</p>
<p class="last">The commands to remove files are executed with the current
permissions of the AMPS process.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.31:</strong> <em>Removing Files</em></p>
<p>This module requires an <code class="docutils literal"><span class="pre">Age</span></code> parameter that specifies the age of the
files to remove, as determined by the update to the file. This module
also requires a <code class="docutils literal"><span class="pre">Pattern</span></code> parameter that specifies a pattern for
locating files to remove.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Age</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the age of files to process. The module
removes any file older than the specified <code class="docutils literal"><span class="pre">Age</span></code>
that matches the specified <code class="docutils literal"><span class="pre">Pattern</span></code>. For example,
when the <code class="docutils literal"><span class="pre">Age</span></code> is <code class="docutils literal"><span class="pre">5d</span></code>, only files that have not
modified within 5 days and that match the pattern
will be processed by the module.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Pattern</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the pattern for files to remove. The
module removes any files that match the specified
<code class="docutils literal"><span class="pre">Pattern</span></code> that have not been modified more
recently than the specified <code class="docutils literal"><span class="pre">Age</span></code>.</p>
<p>This parameter is interpreted as a Unix shell
globbing pattern. It is <em>not</em> interpreted as a
regular expression.</p>
<p>As with other parameters that use the file system,
when the pattern specified is a relative path the
parameter is interpreted relative to the current
working directory of the AMPS process. When the
pattern specified is an absolute path, AMPS uses the
absolute path.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Keep</span></code></td>
<td><p class="first">Specifies the number of files that meet the Age and
Pattern criteria to retain. When this parameter is
specified, AMPS will remove files matching the
criteria, starting with the oldest files, and stop
when the number of remaining files is the number
specified in this parameter.</p>
<p class="last">There is no default for this parameter. When both
<code class="docutils literal"><span class="pre">Keep</span></code> and <code class="docutils literal"><span class="pre">Count</span></code> are specified, AMPS will not
remove any files if the number of files meeting the
criteria is less than the number specified in the
<code class="docutils literal"><span class="pre">Keep</span></code> parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Count</span></code></td>
<td><p class="first">Specifies the maximum number of files that meet the
<code class="docutils literal"><span class="pre">Age</span></code> and <code class="docutils literal"><span class="pre">Pattern</span></code> criteria to remove. AMPS
will remove files matching the criteria, starting
with the oldest files, and stop when the number of
files specified in this parameter have been removed.</p>
<p class="last">There is no default for this parameter. When both
<code class="docutils literal"><span class="pre">Keep</span></code> and <code class="docutils literal"><span class="pre">Count</span></code> are specified, AMPS will not
remove any files if the number of files meeting the
criteria is less than the number specified in the
<code class="docutils literal"><span class="pre">Keep</span></code> parameter.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.32:</strong> <em>Parameters for Removing Files</em></p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="deleting-messages-from-sow">
<span id="ug-actions-do-delete-sow"></span><h4>Deleting Messages from SOW<a class="headerlink" href="#deleting-messages-from-sow" title="Permalink to this headline">¶</a></h4>
<p>AMPS also provides modules for deleting SOW contents. The
<code class="docutils literal"><span class="pre">amps-action-do-delete-sow</span></code> module deletes messages from the specified
SOW topic.</p>
<p>This module requires the <code class="docutils literal"><span class="pre">MessageType</span></code>, <code class="docutils literal"><span class="pre">Topic</span></code>, and <code class="docutils literal"><span class="pre">Filter</span></code>
parameters in order to delete the desired message.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td><p class="first">The MessageType of the SOW topic or topics to
delete from.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td><p class="first">The name of the SOW topic from which to delete
messages. This parameter supports regular
expressions.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Filter</span>
</pre></div>
</div>
</td>
<td>Set the filter to apply. Only messages matching
that filter will be deleted.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.33:</strong> <em>Parameters for Deleting SOW Messages</em></p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="compacting-a-sow-file">
<span id="ug-actions-do-compact-sow"></span><h4>Compacting a SOW File<a class="headerlink" href="#compacting-a-sow-file" title="Permalink to this headline">¶</a></h4>
<p>AMPS also provides a module for reducing the unused space in a
SOW file. The <code class="docutils literal"><span class="pre">amps-action-do-compact-sow</span></code> module rearranges the
messages in the SOW into a smaller amount of space, where possible.
Since AMPS uses memory-mapped files to store messages for the
State of the World topic, this can also potentially reduce the
memory footprint of the topic.</p>
<p>This module can compact a specific SOW file, or the SOW files for every
topic in the instance. When a <code class="docutils literal"><span class="pre">MessageType</span></code> and <code class="docutils literal"><span class="pre">Topic</span></code> are
provided, this module compacts the SOW file for that topic. Otherwise,
the module compacts the file for all topics in the SOW.</p>
<p>While messages are being added or updated within a topic in the SOW,
AMPS reuses free space as possible: it is not necessary to compact the
SOW file during most normal operation. This action is most useful after
an activity peak that leaves a large amount of unneeded space in the
file, or in installations where space is at a premium. Depending on the
file size, the number of topics to be compacted, and the amount of free
space, the reorganization that this operation performs may require a
noticeable amount of I/O bandwidth. 60East recommends that this action
run during a maintenance window or in response to a critical lack of
disk space.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">MessageType</span></code></td>
<td><p class="first">The MessageType of the SOW topic or topics to
compact. This option must be specified if the
<code class="docutils literal"><span class="pre">Topic</span></code> is provided.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Topic</span></code></td>
<td><p class="first">The name of the SOW topic from which to compact.
This option must be specified if the
<code class="docutils literal"><span class="pre">MessageType</span></code> is provided.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.34:</strong> <em>Parameters for Deleting SOW Messages</em></p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="querying-a-sow-topic">
<span id="ug-actions-do-query-sow"></span><h4>Querying a SOW Topic<a class="headerlink" href="#querying-a-sow-topic" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides a module for querying a SOW topic. The
<code class="docutils literal"><span class="pre">amps-action-do-query-sow</span></code> queries the SOW topic, and stores the first
message returned by the SOW query into a user-defined variable.</p>
<p>This module requires the <code class="docutils literal"><span class="pre">MessageType</span></code>, <code class="docutils literal"><span class="pre">Topic</span></code>, and <code class="docutils literal"><span class="pre">Filter</span></code>
parameters to identify the query to run. This module requires the
<code class="docutils literal"><span class="pre">CaptureData</span></code> parameter in order to be able to store the result of the
query.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The message type of the topic to query. There is no
default for this parameter</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td>The name of the topic to query. This topic must be a
SOW topic, a view, a queue, or a conflated topic.
There is no default for this parameter. This
parameter supports regular expressions.</td>
</tr>
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Filter</span>
</pre></div>
</div>
</td>
<td>Set the filter to apply. If a <code class="docutils literal"><span class="pre">Filter</span></code> is present,
only messages matching that filter will be returned
by the query.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">CaptureData</span>
</pre></div>
</div>
</td>
<td>Sets the name of the variable within which AMPS will
store the first message returned.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">DefaultData</span></code></td>
<td>If no records are found, AMPS stores the
<code class="docutils literal"><span class="pre">DefaultData</span></code> in the variable specified by
<code class="docutils literal"><span class="pre">CaptureData</span></code>.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">OrderBy</span></code></td>
<td>An <code class="docutils literal"><span class="pre">OrderBy</span></code> expression to use to order the
results returned by the query. For example, to order
in descending order of the <code class="docutils literal"><span class="pre">/date</span></code> field in the
messages, you would provide an <code class="docutils literal"><span class="pre">OrderBy</span></code> option of
<code class="docutils literal"><span class="pre">/date</span> <span class="pre">DESC</span></code>.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.35:</strong> <em>Parameters for Querying SOW Messages</em></p>
<p>Once you query messages from the SOW topic, you can use the captured
data in other actions. The example below uses
<code class="docutils literal"><span class="pre">amps-action-do-query-sow</span></code> to query the SOW on a schedule in order to
echo messages to the log for diagnostic purposes:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-schedule<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Every&gt;</span>Saturday at 23:59<span class="nt">&lt;/Every&gt;</span>
                <span class="nt">&lt;Name&gt;</span>Diagnostic_Schedule<span class="nt">&lt;/Name&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-query-sow<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>xml<span class="nt">&lt;/MessageType&gt;</span>
                <span class="nt">&lt;Topic&gt;</span>SOW_TOPIC<span class="nt">&lt;/Topic&gt;</span>
                <span class="nt">&lt;Filter&gt;</span>/Trans/Order/@Oname = &#39;PURCHASE&#39;<span class="nt">&lt;/Filter&gt;</span>
                <span class="nt">&lt;CaptureData&gt;</span>AMPS_DATA<span class="nt">&lt;/CaptureData&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-extract-values<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>xml<span class="nt">&lt;/MessageType&gt;</span>
                <span class="nt">&lt;Data&gt;</span>{{AMPS_DATA}}<span class="nt">&lt;/Data&gt;</span>
                <span class="nt">&lt;Value&gt;</span>SAVED_VARIABLE=/Value<span class="nt">&lt;/Value&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-echo-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Message&gt;</span>{{SAVED_VARIABLE}} was in the message<span class="nt">&lt;/Message&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="manage-security">
<span id="ug-actions-do-security"></span><h4>Manage Security<a class="headerlink" href="#manage-security" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides modules for managing the security features of an instance.</p>
<p>Authentication and entitlement can be enabled or disabled, which is
useful for debugging or auditing purposes. You can also reset security
and authentication, which clears the AMPS internal caches and gives
security and authentication modules the opportunity to reinitialize
themselves, for example, by re-parsing an entitlements file.</p>
<p>AMPS loads the following modules by default:</p>
<table border="1" class="docutils">
<colgroup>
<col width="42%" />
<col width="58%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-disable-authentication</span></code></td>
<td>Disables authentication for the instance.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps-action-do-disable-entitlement</span></code></td>
<td>Disables entitlement for the instance.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-enable-authentication</span></code></td>
<td>Enables authentication for the instance.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps-action-do-enable-entitlement</span></code></td>
<td>Enables entitlement for the instance.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-reset-authentication</span></code></td>
<td>Resets authentication by clearing AMPS caches and
reinitializing authentication</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps-action-do-reset-entitlement</span></code></td>
<td>Resets entitlement by clearing AMPS caches and
reinitializing entitlement</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.36:</strong> <em>Security Modules</em></p>
<p>These modules require no parameters. The
<code class="docutils literal"><span class="pre">amps-action-do-reset-authentication</span></code> module and the
<code class="docutils literal"><span class="pre">amps-action-do-reset-entitlement</span></code> module accept an optional
<code class="docutils literal"><span class="pre">Transport</span></code> parameter which specifies the transport to reset.</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Transport</span></code></td>
<td><p class="first">The <code class="docutils literal"><span class="pre">Name</span></code> of the transport for which to reset
authentication or entitlements.</p>
<p class="last">If no <code class="docutils literal"><span class="pre">Name</span></code> is provided, these modules affect all
transports.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">AuthenticationId</span></code></td>
<td><p class="first">The <code class="docutils literal"><span class="pre">authentication</span> <span class="pre">id</span></code> of the client for which to
reset entitlements.</p>
<p class="last">If no id is provided, these modules affect all
clients.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.37:</strong> <em>Parameters for Reset Authentication or Entitlement</em></p>
<p>These modules do not add any variables to the AMPS context.</p>
</div>
<div class="section" id="enable-and-disable-a-transport">
<span id="ug-actions-do-transports"></span><h4>Enable and Disable a Transport<a class="headerlink" href="#enable-and-disable-a-transport" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides modules that can enable and disable specific transports.
The <code class="docutils literal"><span class="pre">amps-action-do-enable-transport</span></code> module enables a transport. The
<code class="docutils literal"><span class="pre">amps-action-do-disable-transport</span></code> module disables a transport.</p>
<table border="1" class="docutils">
<colgroup>
<col width="54%" />
<col width="46%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-enable-transport</span></code></td>
<td>Enables a specific transport.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps-action-do-disable-transport</span></code></td>
<td>Disables a specific transport.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.38:</strong> <em>Transport Action Modules</em></p>
<p>Both modules require the name of the transport to disable or enable.</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Transport</span></code></td>
<td><p class="first">The <code class="docutils literal"><span class="pre">Name</span></code> of the transport to enable or disable.</p>
<p class="last">If no <code class="docutils literal"><span class="pre">Name</span></code> is provided, the module affects all
transports.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.39:</strong> <em>Parameters for Managing Transports</em></p>
<p>Both modules do not add any variables to the AMPS context.</p>
</div>
<div class="section" id="publishing-messages">
<span id="ug-actions-do-publish-message"></span><h4>Publishing Messages<a class="headerlink" href="#publishing-messages" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-publish-message</span></code> module publishes a message into a
specified topic.</p>
<p>Publishes from this action are treated as publishes from an AMPS client
inside the AMPS engine. This means that:</p>
<ul class="simple">
<li>There are no user credentials associated with the publish, so
entitlements are not applied.</li>
<li>There is no special handling for the publish. The publish is recorded
in the transaction log exactly as if it arrived from outside of the
instance, and is processed within the instance as if the had arrived
from an external publisher.</li>
</ul>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="warning" src="../_images/warning.svg" /></td>
<td><p class="first">This action is treated by the AMPS engine as a publish from an
internal AMPS client.When an <code class="docutils literal"><span class="pre">amps-action-do-publish-message</span></code>
runs in response to the <code class="docutils literal"><span class="pre">amps-action-on-publish-message</span></code> event
or the <code class="docutils literal"><span class="pre">amps-action-on-deliver-message</span></code> event, use caution
when the message published from this action could cause the
event to trigger again.</p>
<p>This warning includes cases where the action publishes to a
topic directly monitored by the action, cases where the action
monitors a view and publishes to an underlying topic of the
view. The warning also applies to configurations in which two or
more actions &#8220;cross publish&#8221; to topics that are monitored by the
other action. An example of the last case is an action that
monitors <code class="docutils literal"><span class="pre">TopicOne</span></code> and publishes to <code class="docutils literal"><span class="pre">TopicTwo</span></code>, while
another action monitors <code class="docutils literal"><span class="pre">TopicTwo</span></code> and publishes to
<code class="docutils literal"><span class="pre">TopicOne</span></code>.</p>
<p class="last">The result of a configuration like the ones described above is
called a <em>publish loop</em>. AMPS does not support unterminated
publish loops or loops that produce a large number of cycles
before terminating.</p>
</td>
</tr>
</tbody>
</table>
<p>To publish a message, this module requires the <code class="docutils literal"><span class="pre">MessageType</span></code>, a
<code class="docutils literal"><span class="pre">Topic</span></code> to publish on, and also the <code class="docutils literal"><span class="pre">Data</span></code> that the message will
contain.</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The MessageType for the topic. There is no default for
this parameter.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Topic</span>
</pre></div>
</div>
</td>
<td>The topic of the message being published.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Data</span></code></td>
<td>The data that the message will contain.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Delta</span></code></td>
<td>Whether to use a delta publish. When this option is
present, and the value is <code class="docutils literal"><span class="pre">true</span></code>, the action will
use a delta publish.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">UpdateOnly</span></code></td>
<td><p class="first">Specifies whether a delta publish is allowed to insert
a record, or only update a record. When a delta publish
is specified (that is, <code class="docutils literal"><span class="pre">Delta</span></code> is <code class="docutils literal"><span class="pre">true</span></code> ),
and this option is set to <code class="docutils literal"><span class="pre">true</span></code>, AMPS will only
accept the publish if there is a record present
to be updated.</p>
<p class="last">When no value is specified, this option is <code class="docutils literal"><span class="pre">false</span></code></p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.40:</strong> <em>Parameters for Publishing Messages</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="warning" src="../_images/warning.svg" /></td>
<td><p class="first">This action is treated by the AMPS engine as a publish from an
internal AMPS client.When an <code class="docutils literal"><span class="pre">amps-action-do-publish-message</span></code>
runs in response to the <code class="docutils literal"><span class="pre">amps-action-on-publish-message</span></code> event
or the <code class="docutils literal"><span class="pre">amps-action-on-deliver-message</span></code> event, use caution
when the message published from this action could cause the
event to trigger again.</p>
<p>This includes both cases where the action publishes to a topic
directly monitored by the action, cases where the action
monitors a view and publishes to an underlying topic of the
view, and cases where two or more actions each publish to a
topic that is monitored by another action.</p>
<p class="last">In effect, a configuration like the one described above creates
a recursive call to the action: that recursion must terminate,
and must terminate at a relatively low depth. (The exact limits
depend on system capacity, message size, and so on).</p>
</td>
</tr>
</tbody>
</table>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="manage-replication">
<span id="ug-actions-do-replications"></span><h4>Manage Replication<a class="headerlink" href="#manage-replication" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides modules for downgrading replication destinations that fall
behind and upgrading them again when they catch up.</p>
<table border="1" class="docutils">
<colgroup>
<col width="51%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-downgrade-replication</span></code></td>
<td>Downgrades replication connections from
synchronous to asynchronous if the age
of the last acknowledged message is
older than a specified time period.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps-action-do-upgrade-replication</span></code></td>
<td>Upgrades previously-downgraded
replication connections from
asynchronous to synchronous if the age
of the last acknowledged message is
more recent than a specified time
period. This action has no effect on
replication destinations that are
specified as <code class="docutils literal"><span class="pre">async</span></code> in the
configuration file.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.41:</strong> <em>Replication Modules</em></p>
<p>The modules determine when to downgrade and upgrade based on the age of
the oldest message that a destination has not yet acknowledged. When
using these modules, it is important that the thresholds for the modules
are not set too close together. Otherwise, AMPS may repeatedly upgrade
and downgrade the connection when the destination is consistently
acknowledging messages at a rate close to the threshold values. To avoid
this, 60East recommends that the <code class="docutils literal"><span class="pre">Age</span></code> set for the upgrade module is
1/2 of the age used for the downgrade module.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-downgrade-replication</span></code> module accepts the
following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Age</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the maximum message age at which AMPS
downgrades a replication destination to <code class="docutils literal"><span class="pre">async</span></code>.
When this action runs, AMPS downgrades any
destination for which the oldest unacknowledge
message is older than the specified <code class="docutils literal"><span class="pre">Age</span></code>.</p>
<p>For example, when the <code class="docutils literal"><span class="pre">Age</span></code> is <code class="docutils literal"><span class="pre">5m</span></code>, AMPS will
downgrade any destination where a message older than
5 minutes has not been acknowledged.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">GracePeriod</span></code></td>
<td>The approximate time to wait after start up before
beginning to check whether to downgrade links. The
<code class="docutils literal"><span class="pre">GracePeriod</span></code> allows time for other AMPS instances
to start up, and for connections to be established
between AMPS instances.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.42:</strong> <em>Parameters for Downgrading Replication</em></p>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-upgrade-replication</span></code> module only applies to
destinations configured as <code class="docutils literal"><span class="pre">sync</span></code> that have been previously
downgraded. The module accepts the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Age</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the maximum message age at which a
previously-downgraded destination will be upgraded
to <code class="docutils literal"><span class="pre">sync</span></code> mode. When this action runs, AMPS
upgrades any destination that has been previously
downgraded where the oldest unacknowledged message
to AMPS is more recent than time value specified in
the <code class="docutils literal"><span class="pre">Age</span></code> parameter.</p>
<p>For example, if a destination has been downgraded to
<code class="docutils literal"><span class="pre">async</span></code> mode and the <code class="docutils literal"><span class="pre">Age</span></code> is <code class="docutils literal"><span class="pre">2m</span></code>, AMPS will
upgrade the destination when the oldest
unacknowledged message to that destination is less
than 2 minutes old.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">GracePeriod</span></code></td>
<td>The approximate time to wait after start up before
beginning to check whether to upgrade links. The
<code class="docutils literal"><span class="pre">GracePeriod</span></code> allows time for other AMPS instances
to start up, and for connections to be established
between AMPS instances.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.43:</strong> <em>Parameters for Upgrading Replication</em></p>
<p>These modules do not add any variables to the AMPS context.</p>
</div>
<div class="section" id="extract-values">
<span id="ug-actions-do-extract-values"></span><h4>Extract Values<a class="headerlink" href="#extract-values" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-extract-values</span></code> module extracts message values
from a message and stores the values in a variable.</p>
<p>To extract values from a message, this module requires the
<code class="docutils literal"><span class="pre">MessageType</span></code>, <code class="docutils literal"><span class="pre">Data</span></code>, and <code class="docutils literal"><span class="pre">Value</span></code> parameters.</p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">MessageType</span>
</pre></div>
</div>
</td>
<td>The MessageType for the message to parse. There is no
default for this parameter.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Data</span></code></td>
<td>Contains the data to parse: typically a message
received from a publish event or retrieved from a SOW
query. There is no default value for this parameter.
If it is omitted, AMPS will not parse data when the
action is run.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Value</span></code></td>
<td><p class="first">An assignment statement that specifies the variable
to store the extracted value in and the XPath
identifier for the value to extract. This action can
contain any number of <code class="docutils literal"><span class="pre">Value</span></code> elements, each
providing an assignment statement.</p>
<p>The format of the assignment is as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">variable</span><span class="o">=</span><span class="n">amps</span><span class="o">-</span><span class="n">expression</span>
</pre></div>
</div>
<p>For example, the following assignment statement stores
the value of the <code class="docutils literal"><span class="pre">/previousRegionCode</span></code> within the
message to the variable <code class="docutils literal"><span class="pre">PREVIOUS_REGION</span></code>. After
this action runs, the content of the variable can be
referenced in subsequent actions as
<code class="docutils literal"><span class="pre">{{PREVIOUS_REGION}}</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">PREVIOUS_REGION</span><span class="o">=/</span><span class="n">previousRegionCode</span>
</pre></div>
</div>
<p>Likewise, the following assignment statement creates a string from the values
of the <code class="docutils literal"><span class="pre">/firstName</span></code> and <code class="docutils literal"><span class="pre">/lastName</span></code> fields within the
message, and stores that to the variable <code class="docutils literal"><span class="pre">COMBINED_NAME</span></code>. After this
action runs, the content of the variable can be referenced in subsequent actions as
<code class="docutils literal"><span class="pre">{{COMBINED_NAME}}</span></code>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">COMBINED_NAME</span><span class="o">=</span><span class="n">CONCAT</span><span class="p">(</span><span class="o">/</span><span class="n">firstName</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="o">/</span><span class="n">lastName</span><span class="p">)</span>
</pre></div>
</div>
<p class="last">There is no default for this option. If no <code class="docutils literal"><span class="pre">Value</span></code>
options are provided, AMPS does not save any values
from the parsed message.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.44:</strong> <em>Parameters for Extract Values</em></p>
<p>The module <code class="docutils literal"><span class="pre">amps-action-do-extract-values</span></code> adds the variables
specified by the <code class="docutils literal"><span class="pre">Value</span></code> options to the current context.</p>
</div>
<div class="section" id="translate-data">
<span id="ug-actions-do-translate-values"></span><h4>Translate Data<a class="headerlink" href="#translate-data" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-translate-data</span></code> action allows you to translate the
value from variables in the current context. One common use for this
action is to translate a large number of status values into a smaller
number of states before publishing that information in a message. For
example, an order processing system may track a large number of
finely-grained status codes, while the reporting view for customers may
want to map those status codes to a smaller set of codes such as
&#8220;pending&#8221;, &#8220;shipped&#8221;, and &#8220;delivered&#8221;. This action allows you to easily
translate those codes within AMPS.</p>
<p>When used to assemble a message, this action provides equivalent results
to a set of nested conditional statements in a view projection. However,
if you are using actions to parse, assemble, and publish messages, this
action gives you the ability to change values.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Data</span>
</pre></div>
</div>
</td>
<td>The data to translate. Most often, this is the value
of a variable in the current context.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Value</span>
</pre></div>
</div>
</td>
<td>The variable to store the translated value in.</td>
</tr>
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Case</span></code></td>
<td><p class="first">A translation statement. The translation statement
takes the form of <code class="docutils literal"><span class="pre">original_value=translated_value</span></code>.
This action allows you to provide any number of
<code class="docutils literal"><span class="pre">Case</span></code> statements.</p>
<p>The action matches the <code class="docutils literal"><span class="pre">Data</span></code> provided to the
<code class="docutils literal"><span class="pre">original_value</span></code> in each <code class="docutils literal"><span class="pre">Case</span></code> statement. When
it finds a matching value, the action stores the
translated value in the variable identified by the
<code class="docutils literal"><span class="pre">Value</span></code> statement.</p>
<p>For example, the following translation statement
translates a value of <code class="docutils literal"><span class="pre">credit_check_in_progress</span></code> to
a value of <code class="docutils literal"><span class="pre">pending</span></code></p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">Case</span><span class="o">&gt;</span><span class="n">credit_check_in_progress</span><span class="o">=</span><span class="n">pending</span><span class="o">&lt;/</span><span class="n">Case</span><span class="o">&gt;</span>
</pre></div>
</div>
<p class="last">There is no default for this option.</p>
</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">Default</span></code></td>
<td><p class="first">The default translation. AMPS sets the value of the
variable to the contents of this element if no Case
statement matches the Data provided.</p>
<p class="last">This element is optional. If no <code class="docutils literal"><span class="pre">Default</span></code> is
specified, AMPS uses the value of the original
<code class="docutils literal"><span class="pre">Data</span></code> as the default translation.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.45:</strong> <em>Parameters for Translate Data</em></p>
</div>
<div class="section" id="increment-counter">
<span id="ug-actions-do-increment-counter"></span><h4>Increment Counter<a class="headerlink" href="#increment-counter" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-increment-counter</span></code> module allows AMPS to increment
a counter by a value. Counters persist across action runs, and are saved
in the instance memory until the instance is restarted.</p>
<p>If a counter with the specified name does not currently exist in the
instance when the action runs, AMPS creates the counter with a value of
0 and then immediately increments it with the specified value. If the
counter is already present, AMPS will simply increment the counter.</p>
<p>To see an example of <code class="docutils literal"><span class="pre">amps-action-do-increment-counter</span></code>, refer to the
Action Configuration Examples section at the end of this chapter.</p>
<p>This module requires a <code class="docutils literal"><span class="pre">Key</span></code> that tells AMPS which counter to
increment and a <code class="docutils literal"><span class="pre">Value</span></code> that tells AMPS where to store the incremented
value.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Key</span>
</pre></div>
</div>
</td>
<td>The name of the counter that AMPS will increment.
There is no default value for this parameter.</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Value</span>
</pre></div>
</div>
</td>
<td>The variable in which to store the current value of
the counter.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.46:</strong> <em>Parameter for Increment Counter</em></p>
<p>This module adds variable that contains the counter, as specified in the
<code class="docutils literal"><span class="pre">Value</span></code> parameter, to the current context.</p>
</div>
<div class="section" id="raising-a-custom-event">
<span id="ug-actions-do-raise-event"></span><h4>Raising a Custom Event<a class="headerlink" href="#raising-a-custom-event" title="Permalink to this headline">¶</a></h4>
<p>The AMPS action system provides a way to create custom events and run an
action when the custom event is raised. A custom event is raised by
the <code class="docutils literal"><span class="pre">amps-action-do-execute-event</span></code> action. Events are received
by the <code class="docutils literal"><span class="pre">amps-action-on-execute-event</span></code> module.</p>
<p>This action requires <strong>one</strong> of the following parameters:</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Event</span>
</pre></div>
</div>
</td>
<td><p class="first">The name of the event to raise.</p>
<p class="last">There is no default value for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">EventVariable</span>
</pre></div>
</div>
</td>
<td><p class="first">The variable from which to retrieve the name of the
event to raise.</p>
<p class="last">There is no default value for this parameter.</p>
</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.47:</strong> <em>Parameters for Do Execute Event</em></p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="executing-system-commands">
<span id="ug-actions-do-execute-system"></span><h4>Executing System Commands<a class="headerlink" href="#executing-system-commands" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-execute-system</span></code> module allows AMPS to execute
system commands.</p>
<p>The parameter for this module is simply the command. The command
executes in the current working directory of the AMPS process, with the
credentials and environment of the AMPS process.</p>
<p>The thread used to execute the command is monitored by AMPS thread
monitoring. This means that the command must complete within a
short period of time (on the order of a second or two at the longest)
or AMPS may consider the thread to have become deadlocked.</p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Command</span></code></td>
<td>The command to execute. When the action runs, this
command is executed as a shell command on the system
where AMPS is running.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.48:</strong> <em>Parameter for Execute System</em></p>
<p>This module does not add any variables to the AMPS context.</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="86%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><img alt="caution" src="../_images/caution.svg" /></td>
<td>This module executes system commands with the credentials of the
AMPS process. It is possible to damage the system, interrupt the
AMPS service, or cause data loss by executing commands with this
module. 60East recommends against using any data extracted from
an AMPS message in the command executed.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="debugging-actions">
<span id="ug-actions-debugging"></span><h4>Debugging Actions<a class="headerlink" href="#debugging-actions" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides modules for debugging your AMPS action configuration.</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-nothing</span></code></td>
<td>Takes no action. Does not modify the state of AMPS in any way.
The module simply logs that it was called.</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal"><span class="pre">amps-action-do-echo-message</span></code></td>
<td>Echoes the specified message to the log. The message appears in
the log as message <code class="docutils literal"><span class="pre">29-0103</span></code>,at <code class="docutils literal"><span class="pre">info</span></code> level.The logging
configuration must allow this message to be recorded for the
output of this action to appear in the log.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.49:</strong> <em>Debugging Modules</em></p>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-nothing</span></code> module requires no parameters.</p>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-echo-message</span></code> module requires the following
parameter:</p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">Message</span></code></td>
<td>The message to echo. The default for this parameter
is simply an empty string.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.50:</strong> <em>Parameter for Echo Message</em></p>
<p>These modules do not add any variables to the AMPS context.</p>
</div>
<div class="section" id="creating-a-minidump">
<span id="ug-actions-do-minidump"></span><h4>Creating a Minidump<a class="headerlink" href="#creating-a-minidump" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides a module for creating a minidumps. The
<code class="docutils literal"><span class="pre">amps-action-do-minidump</span></code> module provides a way for developers and/or
administrators to easily create minidumps for diagnostic purposes.</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-minidump</span></code></td>
<td>Creates a minidump.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.51:</strong> <em>Creating a Minidump Module</em></p>
<p>This module does not require any parameters.</p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
<div class="section" id="shut-down-amps">
<span id="ug-actions-shutdown-amps"></span><h4>Shut Down AMPS<a class="headerlink" href="#shut-down-amps" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal"><span class="pre">amps-action-do-shutdown</span></code> module shuts down AMPS. This module is
registered as the default action for several Linux signals, as described
in <a class="reference internal" href="#ug-actions-default-signal"><span class="std std-ref">Default Signal Actions</span></a>.</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-do-shutdown</span></code></td>
<td>Shuts down AMPS.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.52:</strong> <em>Shut Down Module</em></p>
<p>This module does not require any parameters.</p>
<p>This module does not add any variables to the AMPS context.</p>
</div>
</div>
<div class="section" id="if-element-conditionally-stop-action-sequence">
<span id="ug-if-actions"></span><h3>If Element: Conditionally Stop Action Sequence<a class="headerlink" href="#if-element-conditionally-stop-action-sequence" title="Permalink to this headline">¶</a></h3>
<p>AMPS includes the ability to run actions only if certain conditions are
true. For some actions (such as the replication management actions), the
condition is included as a part of the action. In other cases, AMPS
provides <code class="docutils literal"><span class="pre">If</span></code> actions.</p>
<p>An <code class="docutils literal"><span class="pre">If</span></code> action is evaluated each time the execution of an action
reaches the <code class="docutils literal"><span class="pre">If</span></code> action. When the condition specified in an <code class="docutils literal"><span class="pre">If</span></code>
action is <code class="docutils literal"><span class="pre">true</span></code>, AMPS proceeds to the next <code class="docutils literal"><span class="pre">Do</span></code> action. If the
condition in an <code class="docutils literal"><span class="pre">If</span></code> action is <code class="docutils literal"><span class="pre">False</span></code>, AMPS does not run any
further <code class="docutils literal"><span class="pre">Do</span></code> elements in the action.</p>
<div class="section" id="file-system-usage">
<span id="ug-actions-if-file-system-usage"></span><h4>File System Usage<a class="headerlink" href="#file-system-usage" title="Permalink to this headline">¶</a></h4>
<p>AMPS provides the following <code class="docutils literal"><span class="pre">If</span></code> module for taking action based on the
file system capacity. AMPS loads this module by default:</p>
<table border="1" class="docutils">
<colgroup>
<col width="38%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Module Name</th>
<th class="head">Does</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal"><span class="pre">amps-action-if-file-system-usage</span></code></td>
<td>Checks whether the specified path on the filesystem meets the
specified usage level. If so, allows execution to continue.
If not, stops the action.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.53:</strong> <em>File System Usage</em></p>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">Path</span>
</pre></div>
</div>
</td>
<td><p class="first">Specifies the filesystem path to monitor. The AMPS
process must have sufficient permissions to check
the disk usage for this path at the time the check
runs.</p>
<p class="last">There is no default for this parameter.</p>
</td>
</tr>
<tr class="row-odd"><td><div class="first last highlight-default"><div class="highlight"><pre><span></span><span class="n">GreaterThan</span>
</pre></div>
</div>
</td>
<td>The threshold to check, specified as a percentage.
If the provided path has more space used than
specified in this parameter, subsequent <code class="docutils literal"><span class="pre">Do</span></code> and
<code class="docutils literal"><span class="pre">If</span></code> blocks will run. Otherwise, the action will
complete with this step.</td>
</tr>
</tbody>
</table>
<p><strong>Table 14.54:</strong> <em>Parameters for Running Actions Based on File System Usage</em></p>
<p>This module does not add any variables to the AMPS context.</p>
<p>For example, the following action will log a message in the AMPS log
every minute when the file system becomes more than 90% full, and
perform a full shutdown of AMPS if the file system is more than 98%
full.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-schedule<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Every&gt;</span>1m<span class="nt">&lt;/Every&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;If&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-if-file-system-usage<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;GreaterThan&gt;</span>90%<span class="nt">&lt;/GreaterThan&gt;</span>
                <span class="nt">&lt;Path&gt;</span>/mnt/fastdrive/amps<span class="nt">&lt;/Path&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/If&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-echo-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Message&gt;</span>ALERT: You&#39;re getting low on space!<span class="nt">&lt;/Message&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
        <span class="nt">&lt;If&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-if-file-system-usage<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;GreaterThan&gt;</span>98%<span class="nt">&lt;/GreaterThan&gt;</span>
                <span class="nt">&lt;Path&gt;</span>/mnt/fastdrive/amps<span class="nt">&lt;/Path&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/If&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-echo-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Message&gt;</span>CRITICAL: Shutting down AMPS<span class="nt">&lt;/Message&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-shutdown<span class="nt">&lt;/Module&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="action-configuration-examples">
<span id="ug-actions-examples"></span><h3>Action Configuration Examples<a class="headerlink" href="#action-configuration-examples" title="Permalink to this headline">¶</a></h3>
<div class="section" id="archive-transaction-log-journal-files-older-than-one-week-every-saturday">
<h4>Archive Transaction Log Journal Files Older Than One Week, Every Saturday<a class="headerlink" href="#archive-transaction-log-journal-files-older-than-one-week-every-saturday" title="Permalink to this headline">¶</a></h4>
<p>The listing below asks AMPS to archive transaction log journal
files older than 1 week, every Saturday at 12:30 AM.</p>
<p>This configuration moves journal files from the <cite>JournalDirectory</cite>
to the <cite>JournalArchiveDirectory</cite>, while maintaining the files as an active
part of the transaction log (ensuring that they are still available for
bookmark replay, replication, and so on):</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-schedule<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Every&gt;</span>Saturday at 00:30<span class="nt">&lt;/Every&gt;</span>
                <span class="nt">&lt;Name&gt;</span>Saturday Night Fever<span class="nt">&lt;/Name&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-archive-journal<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Age&gt;</span>7d<span class="nt">&lt;/Age&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="disable-and-re-enable-security-on-signal">
<h4>Disable and Re-enable Security on Signal<a class="headerlink" href="#disable-and-re-enable-security-on-signal" title="Permalink to this headline">¶</a></h4>
<p>The listing below disables authentication and entitlement when AMPS
receives on the <code class="docutils literal"><span class="pre">USR1</span></code> signal. When AMPS receives the <code class="docutils literal"><span class="pre">USR2</span></code> signal,
AMPS re-enables authentication and entitlement. This configuration is,
in effect, the configuration that AMPS installs by default for these
signals:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-signal<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Signal&gt;</span>SIGUSR1<span class="nt">&lt;/Signal&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-disable-authentication<span class="nt">&lt;/Module&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-disable-entitlement<span class="nt">&lt;/Module&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-signal<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Signal&gt;</span>SIGUSR2<span class="nt">&lt;/Signal&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-enable-authentication<span class="nt">&lt;/Module&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-enable-entitlement<span class="nt">&lt;/Module&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="reset-entitlements-for-a-disconnected-client">
<h4>Reset entitlements for a disconnected client<a class="headerlink" href="#reset-entitlements-for-a-disconnected-client" title="Permalink to this headline">¶</a></h4>
<p>The listing below resets entitlement cache for a client when the client is
disconnected:</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-disconnect-client<span class="nt">&lt;/Module&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-reset-entitlement<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;AuthenticationId&gt;</span>{{AMPS_AUTHENTICATION_ID}}<span class="nt">&lt;/AuthenticationId&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="extract-values-on-publish-of-a-message">
<h4>Extract Values on Publish of a Message<a class="headerlink" href="#extract-values-on-publish-of-a-message" title="Permalink to this headline">¶</a></h4>
<p>The listing below extracts values from a locally published xml message
and stores them into VALUE.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-publish-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Topic&gt;</span>message-sow<span class="nt">&lt;/Topic&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>xml<span class="nt">&lt;/MessageType&gt;</span>
                <span class="nt">&lt;MessageSource&gt;</span>local<span class="nt">&lt;/MessageSource&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-extract-values<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>xml<span class="nt">&lt;/MessageType&gt;</span>
                <span class="nt">&lt;Data&gt;</span>{{AMPS_DATA}}<span class="nt">&lt;/Data&gt;</span>
                <span class="nt">&lt;Value&gt;</span>VALUE = /VALUE<span class="nt">&lt;/Value&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="increment-a-counter-and-echo-a-message-on-signal">
<h4>Increment a Counter and Echo a Message on Signal<a class="headerlink" href="#increment-a-counter-and-echo-a-message-on-signal" title="Permalink to this headline">¶</a></h4>
<p>The listing below increments a counter and echoes the counter&#8217;s value
when AMPS receives on the <code class="docutils literal"><span class="pre">USR1</span></code> signal.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-signal<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Signal&gt;</span>SIGUSR1<span class="nt">&lt;/Signal&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-increment-counter<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Key&gt;</span>MY_COUNTER<span class="nt">&lt;/Key&gt;</span>
                <span class="nt">&lt;Value&gt;</span>CURRENT_COUNTER_VALUE<span class="nt">&lt;/Value&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-echo-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Message&gt;</span>AMPS has gotten {{CURRENT_COUNTER_VALUE}}
                    SIGUSR1 signals.<span class="nt">&lt;/Message&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="recording-expired-queue-messages-in-a-dead-letter-topic">
<h4>Recording Expired Queue Messages in a Dead Letter Topic<a class="headerlink" href="#recording-expired-queue-messages-in-a-dead-letter-topic" title="Permalink to this headline">¶</a></h4>
<p>The listing below detects when a message expires from a queue, and publishes those
messages to a dead letter topic.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-sow-expire-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Topic&gt;</span>interesting-queue<span class="nt">&lt;/Topic&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>json<span class="nt">&lt;/MessageType&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-sow-expire-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Topic&gt;</span>another-interesting-queue<span class="nt">&lt;/Topic&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>json<span class="nt">&lt;/MessageType&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-publish-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Topic&gt;</span>dead-letter<span class="nt">&lt;/Topic&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>json<span class="nt">&lt;/MessageType&gt;</span>
                <span class="nt">&lt;Data&gt;</span>{&quot;topic&quot;:&quot;{{AMPS_TOPIC}}&quot;,&quot;message&quot;:{{AMPS_DATA}} }<span class="nt">&lt;/Data&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="copy-a-message-to-a-different-topic-when-a-timeout-is-exceeded">
<h4>Copy a Message to a Different Topic When a Timeout is Exceeded<a class="headerlink" href="#copy-a-message-to-a-different-topic-when-a-timeout-is-exceeded" title="Permalink to this headline">¶</a></h4>
<p>The listing below, in effect, copies messages from the <code class="docutils literal"><span class="pre">Orders</span></code> topic
to the <code class="docutils literal"><span class="pre">Orders_Stale</span></code> topic when the status has been <code class="docutils literal"><span class="pre">PENDING</span></code> for
more than 5 seconds.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-message-condition-timeout<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>nvfix<span class="nt">&lt;/MessageType&gt;</span>
                <span class="nt">&lt;Topic&gt;</span>Orders<span class="nt">&lt;/Topic&gt;</span>
                <span class="nt">&lt;Filter&gt;</span>/status = &#39;PENDING&#39;<span class="nt">&lt;/Filter&gt;</span>
                <span class="nt">&lt;Duration&gt;</span>5s<span class="nt">&lt;/Duration&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-publish-message<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;MessageType&gt;</span>nvfix<span class="nt">&lt;/MessageType&gt;</span>
                <span class="nt">&lt;Topic&gt;</span>Orders_Stale<span class="nt">&lt;/Topic&gt;</span>
                <span class="nt">&lt;Data&gt;</span>{{AMPS_DATA}}<span class="nt">&lt;/Data&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="shutting-down-amps-when-filesystem-fills">
<h4>Shutting Down AMPS When Filesystem Fills<a class="headerlink" href="#shutting-down-amps-when-filesystem-fills" title="Permalink to this headline">¶</a></h4>
<p>The listing below directs AMPS to perform a graceful shutdown when the
filesystem becomes full, with a check run every 3 seconds.</p>
<div class="highlight-xml"><div class="highlight"><pre><span></span><span class="nt">&lt;Actions&gt;</span>
    <span class="nt">&lt;Action&gt;</span>
        <span class="nt">&lt;On&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-on-schedule<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Every&gt;</span>3s<span class="nt">&lt;/Every&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/On&gt;</span>
        <span class="nt">&lt;If&gt;</span>
         <span class="nt">&lt;Module&gt;</span>amps-action-if-file-system-usage<span class="nt">&lt;/Module&gt;</span>
            <span class="nt">&lt;Options&gt;</span>
                <span class="nt">&lt;Path&gt;</span>./<span class="nt">&lt;/Path&gt;</span>
                <span class="nt">&lt;GreaterThan&gt;</span>99%<span class="nt">&lt;/GreaterThan&gt;</span>
            <span class="nt">&lt;/Options&gt;</span>
        <span class="nt">&lt;/If&gt;</span>
        <span class="nt">&lt;Do&gt;</span>
            <span class="nt">&lt;Module&gt;</span>amps-action-do-shutdown<span class="nt">&lt;/Module&gt;</span>
       <span class="nt">&lt;/Do&gt;</span>
    <span class="nt">&lt;/Action&gt;</span>
<span class="nt">&lt;/Actions&gt;</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2019, 60East Technologies, Inc..
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
    </div>

    

    
  </body>
</html>